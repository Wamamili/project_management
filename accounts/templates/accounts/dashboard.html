{% extends "accounts/base.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<h2>Welcome to your Dashboard</h2>
<p>You are logged in as <strong>{{ user.username }}</strong>.</p>

<a href="{% url 'profile' %}" class="btn btn-info mt-3">View Profile</a>

<div class="mt-4">
    <div class="mt-4">
    <h4>Your Projects</h4>
    {% if projects %}
        <ul class="list-group">
            {% for project in projects %}
                <li class="list-group-item">
                   <a href="{% url 'project_detail' project.pk %}">
                       <strong>{{ project.title }}</strong>
                   </a>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No projects assigned to you yet.</p>
    {% endif %}
</div>

    <h4>API Data:</h4>
    <pre id="api-data">Loading...</pre>
</div>

<script>
    async function fetchDashboardData() {
        try {
            const response = await fetch("{% url 'api_dashboard' %}", {
                headers: {
                    "X-Requested-With": "XMLHttpRequest"
                }
            });
            if (response.ok) {
                const data = await response.json();
                document.getElementById("api-data").textContent = JSON.stringify(data, null, 2);
            } else {
                document.getElementById("api-data").textContent = "Error: " + response.status;
            }
        } catch (error) {
            document.getElementById("api-data").textContent = "Error: " + error;
        }
    }

    fetchDashboardData();
</script>
{% endblock %}
